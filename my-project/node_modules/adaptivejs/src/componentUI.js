/**
 *  Helper for initializing components
 *
 *  Components have their JS dependencies automatically compiled into ui.js
 *  The base.dust template invokes Component.init(), which will iterate over any
 *  components on the page. We asynchronously import the JS dependency and
 *  run it.
 *
 */

define(function() {
    var Component = {};

    // Import and run the module for a given component
    // Set a data attribute indicating this element is initialized
    var run = function run($component, options) {
        var fcn = require($component.data('adaptivejs-component'));

        fcn.init($component, options);
        $component.attr('data-adaptivejs-component-processed', '');
    };

    // Users can invoke this function with one or many instances of components
    // to run initialization on; any options are passed through if the component's
    // JS accepts it
    Component.init = function init($components, options) {
        // With no args, we simply initialize everything present on the page
        $components = $components || $('[data-adaptivejs-component]').not('[data-adaptivejs-component-processed]');

        // Assuming there are no components found or provided, we need to bail
        // lest we attempt to require a module with an undefined module ID
        if (typeof $components === 'undefined' || $components.length === '0') {
            return;
        }

        $components.each(function(_, component) {
            run($(component), options);
        });
    };

    return Component;
});
