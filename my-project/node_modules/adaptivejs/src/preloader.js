define([
    // Built from files in app/preload
    'text!preload-css',
    'text!preload-html',
    'text!preload-js',
    'adaptivejs/utils/buildOrigin'
], function(preloadCss, preloadHtml, preloadJs, buildOrigin) {
    return function() {
        var style = document.createElement('style');
        var container = document.createElement('div');
        var scriptEl = document.createElement('script');
        var meta = document.createElement('meta');

        meta.name = 'viewport';
        meta.content = 'width=device-width';

        container.className = 'preloader unmobify-remove';
        scriptEl.className = 'unmobify-remove';

        // Replace asset paths for preload assets
        preloadHtml = preloadHtml.replace(/<%- assetDir %>/g, buildOrigin());

        style.innerHTML = preloadCss;
        container.innerHTML = preloadHtml;
        scriptEl.innerHTML = preloadJs;

        document.head.appendChild(meta);
        document.head.appendChild(style);

        document.body.appendChild(container);
        document.head.appendChild(scriptEl);
    };
});
