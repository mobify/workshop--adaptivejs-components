/**
 *  Used by dust-requirejs.js and dustPatch.js to determine if component-specific
 *  logic should be enabled.
 *
 *  Checks if component system files necessary for component integration into
 *  Adaptive are stubs. r.js optimizer will provide us a stub.json file if the
 *  files we actually need don't exist.
 */

define(['json!component-installed', 'json!component-locations'], function(installedComponents, componentLocations) {
    if (typeof window === 'undefined') {
        installedComponents = JSON.parse(installedComponents);
        componentLocations = JSON.parse(componentLocations);
    }

    var enabled = false;

    var isEnabled = function() {
        // We expect component.json to have these two fields --- if they don't,
        // we disable component integration within Adaptive.js
        if (componentLocations.hasOwnProperty('stencil') &&
            componentLocations.hasOwnProperty('local') &&
            !installedComponents.hasOwnProperty('stub')) {
            enabled = true;
        }

        return enabled;
    };

    var getLocations = function() {
        return enabled ? componentLocations : undefined;
    };

    var getInstalledComponents = function() {
        return enabled ? installedComponents : undefined;
    };

    return {
        isEnabled: isEnabled,
        getLocations: getLocations,
        getInstalledComponents: getInstalledComponents
    };
});
